<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>办公导航助手</title>
    <meta name="keywords" content="办公导航,工作效率工具,办公常用网址">
    <meta name="description" content="专为上班族设计的高效办公导航站。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="main.css" />
</head>

<body>
    <!-- 头部导航 -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-compass logo-icon"></i>
                <div class="logo-text">
                    <span>办公导航助手</span>
                    <div class="logo-subtitle">高效办公 · 一站导航</div>
                </div>
            </div>

            <!-- 功能按钮区域 -->
            <div class="header-actions">
                <button class="btn-icon btn-outline" id="add-to-favorites" title="添加到收藏夹">
                    <i class="fas fa-star"></i>
                </button>
                <button class="btn-icon btn-outline" id="set-as-homepage" title="设为首页">
                    <i class="fas fa-home"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main>
        <div class="container">
            <!-- 主页 -->
            <section id="home-page" class="page">

                <!-- 搜索栏 -->
                <div class="search-section">
                    <form class="search-form" id="search-form">
                        <div class="search-engine-selector">
                            <h3>选择搜索引擎</h3>
                            <div id="engine-selector" class="engine-options-container">
                                <!-- 搜索引擎选项将通过JS动态生成 -->
                            </div>
                        </div>

                        <div class="search-input-group">
                            <input type="text" class="search-input" id="search-input" placeholder="输入搜索关键词，按回车或点击搜索...">
                            <button type="submit" class="btn"><i class="fas fa-search"></i>搜索</button>
                        </div>
                    </form>
                </div>

                <!-- 网址导航 -->
                <div class="nav-section">
                    <div class="section-header">
                        <div>
                            <h2>常用导航网址</h2>
                            <p>点击图标访问网站，支持编辑功能</p>
                        </div>
                        <div class="edit-mode-controls">
                            <button class="btn btn-secondary" id="toggle-edit"><i class="fas fa-edit"></i>编辑模式</button>
                            <button class="btn" id="add-website"><i class="fas fa-plus"></i>添加网站</button>
                        </div>
                    </div>

                    <div class="category-tabs" id="category-tabs">
                        <!-- 分类标签将通过JS动态生成 -->
                    </div>

                    <div class="websites-grid" id="websites-grid">
                        <!-- 网站卡片将通过JS动态生成 -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 页脚 -->
    <footer>
        <div class="container footer-container">
            <div class="footer-section">
                <h3>办公导航助手</h3>
                <p>一个专为办公环境设计的智能导航网站，提供搜索引擎、常用网址导航、帮助您提高工作效率。</p>
            </div>

            <div class="footer-section">
                <h3>主要功能</h3>
                <p>• 多搜索引擎切换，快速查找信息</p>
                <p>• 常用网址分类导航，一键访问</p>
            </div>

            <div class="footer-section">
                <h3>使用提示</h3>
                <p>所有数据都保存在您的本地浏览器中，支持自定义编辑。点击编辑模式可以添加、修改或删除网站和分类，数据安全有保障。</p>
            </div>
        </div>

        <div class="container copyright">
            <p>&copy; 2025 办公导航助手 | 设计用于办公环境 | 数据本地存储 | 版本 2.0</p>
        </div>
        <div style="width:100%; text-align:center">
            <iframe src="https://xetm.cn/get/inbottom" style="width:260px; height: 30px; border: 0px;"
                scrolling="no"></iframe>
        </div>
    </footer>

    <!-- 添加/编辑网站模态框 -->
    <div class="modal" id="website-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">添加新网站</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>

            <form id="website-form">
                <div class="form-group">
                    <label for="website-name"><i class="fas fa-globe"></i> 网站名称</label>
                    <input type="text" id="website-name" required placeholder="例如：GitHub">
                </div>

                <div class="form-group">
                    <label for="website-url"><i class="fas fa-link"></i> 网站URL</label>
                    <input type="url" id="website-url" required placeholder="https://example.com">
                </div>

                <div class="form-group">
                    <label for="website-category"><i class="fas fa-folder"></i> 分类</label>
                    <select id="website-category" required>
                        <!-- 分类选项将通过JS动态生成 -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="website-icon"><i class="fas fa-icons"></i> 图标 (FontAwesome类名)</label>
                    <input type="text" id="website-icon" placeholder="例如: fas fa-search" required>
                    <small>参考: <a href="https://fontawesome.com/icons" target="_blank">FontAwesome图标库</a>，输入图标类名如 "fas
                        fa-search"</small>
                </div>

                <div class="form-group">
                    <label for="website-description"><i class="fas fa-align-left"></i> 描述 (可选)</label>
                    <textarea id="website-description" rows="3" placeholder="简要描述网站功能或用途"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-modal"><i class="fas fa-times"></i>
                        取消</button>
                    <button type="submit" class="btn"><i class="fas fa-save"></i> 保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 脚本部分 -->
    <script>
        // 数据存储和管理
        const StorageManager = {
            // 初始化默认数据
            initDefaultData: function () {
                // 检查是否已有数据  if (!localStorage.getItem('websites')) {
                if (!localStorage.getItem('websites')) {
                    const defaultWebsites = [
                        { id: 1, name: "DeepSeek", url: "https://chat.deepseek.com", category: "AI助手", icon: "fas fa-search", description: "深度求索公司的大模型" },
                        { id: 2, name: "通义千问", url: "https://tongyi.aliyun.com", category: "AI助手", icon: "fas fa-comments", description: "阿里云推出的AI大模型" },
                        { id: 3, name: "咔咔闹钟", url: " https://apps.apple.com/cn/app/cn/id6752285870", category: "其他", icon: "fa-regular fa-alarm-clock", description: "iPhone 专属智能调休闹钟" },
                        { id: 4, name: "智谱清言", url: "https://chatglm.cn", category: "AI助手", icon: "fas fa-lightbulb", description: "智谱AI的对话助手" },
                        { id: 5, name: "Kimi", url: "https://kimi.moonshot.cn", category: "AI助手", icon: "fas fa-moon", description: "月之暗面推出的大模型" },
                        { id: 6, name: "豆包", url: "https://www.doubao.com", category: "AI助手", icon: "fas fa-seedling", description: "字节跳动推出的AI助手" },
                        { id: 7, name: "文心一言", url: "https://yiyan.baidu.com", category: "AI助手", icon: "fas fa-brain", description: "百度推出的AI对话助手" },
                        { id: 7, name: "讯飞星火", url: "https://xinghuo.xfyun.cn", category: "AI助手", icon: "fas fa-fire", description: "科大讯飞的认知大模型" },
                        { id: 8, name: "腾讯混元", url: "https://hunyuan.tencent.com", category: "AI助手", icon: "fab fa-weixin", description: "腾讯推出的AI大模型" },
                        { id: 10, name: "360智脑", url: "https://ai.360.cn", category: "AI助手", icon: "fas fa-shield-alt", description: "360公司推出的AI大模型" },
                        { id: 11, name: "天工", url: "https://www.tiangong.cn", category: "AI助手", icon: "fas fa-cogs", description: "昆仑万维推出的AI大模型" },

                        { id: 11, name: "腾讯", url: "https://www.qq.com", category: "综合门户", icon: "fa-brands fa-qq", description: "综合性互联网服务提供商" },
                        { id: 38, name: "微信网页版", url: "https://filehelper.weixin.qq.com/", category: "其他", icon: "fa-brands fa-weixin", description: "" },
                        { id: 13, name: "淘宝", url: "https://www.taobao.com", category: "电商平台", icon: "fas fa-shopping-cart", description: "阿里巴巴旗下的C2C电商平台[citation:1]" },
                        { id: 14, name: "京东", url: "https://www.jd.com", category: "电商平台", icon: "fas fa-truck-fast", description: "中国自营式电商企业[citation:1][citation:2]" },
                        { id: 15, name: "新浪", url: "https://www.sina.com.cn", category: "综合门户", icon: "fas fa-newspaper", description: "知名综合门户网站，旗下有新浪微博[citation:2][citation:4]" },
                        { id: 16, name: "网易", url: "https://www.163.com", category: "综合门户", icon: "fas fa-music", description: "综合性门户网站，提供新闻、邮箱、游戏等服务[citation:1][citation:4]" },
                        { id: 17, name: "搜狐", url: "https://www.sohu.com", category: "综合门户", icon: "fab fa-snapchat-ghost", description: "中国主要门户网站之一[citation:4][citation:6]" },
                        { id: 18, name: "微博", url: "https://www.weibo.com", category: "社交媒体", icon: "fab fa-weibo", description: "中国最大的社交媒体平台之一[citation:6]" },
                        { id: 19, name: "知乎", url: "https://www.zhihu.com", category: "社区论坛", icon: "fa-brands fa-zhihu", description: "高质量的问答社区和创作者聚集的平台[citation:5]" },
                        { id: 20, name: "B站（哔哩哔哩）", url: "https://www.bilibili.com", category: "视频平台", icon: "fas fa-play-circle", description: "年轻人喜爱的视频社区[citation:5]" },

                        { id: 21, name: "今日头条", url: "https://www.toutiao.com", category: "综合门户", icon: "fas fa-heading", description: "基于数据化挖掘的个性化信息推荐引擎[citation:1][citation:5]" },
                        { id: 22, name: "爱奇艺", url: "https://www.iqiyi.com", category: "视频平台", icon: "fas fa-film", description: "在线视频网站[citation:1]" },
                        { id: 23, name: "腾讯视频", url: "https://v.qq.com", category: "视频平台", icon: "fas fa-tv", description: "腾讯旗下的视频平台[citation:1][citation:5]" },
                        { id: 24, name: "优酷", url: "https://www.youku.com", category: "视频平台", icon: "fas fa-video", description: "阿里巴巴旗下的视频平台[citation:1]" },
                        { id: 25, name: "小红书", url: "https://www.xiaohongshu.com", category: "社交媒体", icon: "fas fa-book", description: "生活方式分享平台[citation:1]" },
                        { id: 26, name: "豆瓣", url: "https://www.douban.com", category: "社区论坛", icon: "fas fa-star", description: "以书影音为主的社交网络平台[citation:5]" },
                        { id: 27, name: "人民网", url: "https://www.people.com.cn", category: "新闻媒体", icon: "fas fa-landmark", description: "人民日报建设的网上信息交互平台[citation:7][citation:8]" },
                        { id: 28, name: "新华网", url: "https://www.xinhuanet.com", category: "新闻媒体", icon: "fas fa-globe-asia", description: "国家通讯社新华社主办的综合新闻门户[citation:7][citation:8]" },
                        { id: 29, name: "央视网", url: "https://www.cctv.com", category: "新闻媒体", icon: "fas fa-broadcast-tower", description: "中央广播电视总台主办的重点新闻网站[citation:7]" },
                        { id: 30, name: "凤凰网", url: "https://www.ifeng.com", category: "新闻媒体", icon: "fas fa-feather-alt", description: "知名综合门户网站[citation:4]" },
                        { id: 31, name: "美团", url: "https://www.meituan.com", category: "生活服务", icon: "fas fa-utensils", description: "提供餐饮外卖、酒店旅游等服务的平台" },
                        { id: 32, name: "携程", url: "https://www.ctrip.com", category: "生活服务", icon: "fas fa-plane", description: "在线旅行服务公司" },
                        { id: 33, name: "拼多多", url: "https://www.pinduoduo.com", category: "电商平台", icon: "fas fa-hand-holding-usd", description: "专注于团购的社交电商平台" },
                        { id: 34, name: "抖音", url: "https://www.douyin.com", category: "视频平台", icon: "fas fa-video", description: "字节跳动旗下的短视频社交平台" },
                        { id: 35, name: "百度贴吧", url: "https://tieba.baidu.com", category: "社区论坛", icon: "fas fa-users", description: "基于关键词的主题交流社区[citation:7]" },
                        { id: 36, name: "百度翻译", url: "https://fanyi.baidu.com", category: "其他", icon: "fa-solid fa-language", description: "" },
                        { id: 37, name: "码农VIP", url: "https://www.manongvip.com", category: "其他", icon: "fa-brands fa-ideal", description: "" }

                    ];
                    localStorage.setItem('websites', JSON.stringify(defaultWebsites));
                }

                //if (!localStorage.getItem('categories')) {
                if (!localStorage.getItem('categories')) {
                    const defaultCategories = ["全部", "AI助手", "综合门户", "电商平台", "社交媒体", "视频平台", "生活服务", "社区论坛", "其他"];
                    localStorage.setItem('categories', JSON.stringify(defaultCategories));
                }

                //if (!localStorage.getItem('searchEngines')) {
                if (!localStorage.getItem('searchEngines')) {
                    const defaultEngines = [
                        { name: "百度", url: "https://www.baidu.com/s?wd=", icon: "fas fa-search" },
                        { name: "Google", url: "https://www.google.com/search?q=", icon: "fab fa-google" },
                        { name: "Bing", url: "https://www.bing.com/search?q=", icon: "fab fa-microsoft" },
                        { name: "GitHub", url: "https://github.com/search?q=", icon: "fab fa-github" },
                        { name: "知乎", url: "https://www.zhihu.com/search?type=content&q=", icon: "fas fa-question-circle" }
                    ];
                    localStorage.setItem('searchEngines', JSON.stringify(defaultEngines));
                    localStorage.setItem('selectedEngine', JSON.stringify(defaultEngines[0]));
                }
            },

            // 获取数据
            getWebsites: function () {
                return JSON.parse(localStorage.getItem('websites')) || [];
            },

            getCategories: function () {
                return JSON.parse(localStorage.getItem('categories')) || [];
            },

            getSearchEngines: function () {
                return JSON.parse(localStorage.getItem('searchEngines')) || [];
            },

            getSelectedEngine: function () {
                return JSON.parse(localStorage.getItem('selectedEngine')) || this.getSearchEngines()[0];
            },

            // 保存数据
            saveWebsites: function (websites) {
                localStorage.setItem('websites', JSON.stringify(websites));
            },

            saveCategories: function (categories) {
                localStorage.setItem('categories', JSON.stringify(categories));
            },

            saveSearchEngines: function (engines) {
                localStorage.setItem('searchEngines', JSON.stringify(engines));
            },

            saveSelectedEngine: function (engine) {
                localStorage.setItem('selectedEngine', JSON.stringify(engine));
            },

            // 添加新网站
            addWebsite: function (website) {
                const websites = this.getWebsites();
                website.id = Date.now(); // 使用时间戳作为ID
                websites.push(website);
                this.saveWebsites(websites);
                return website;
            },

            // 更新网站
            updateWebsite: function (updatedWebsite) {
                const websites = this.getWebsites();
                const index = websites.findIndex(w => w.id === updatedWebsite.id);
                if (index !== -1) {
                    websites[index] = updatedWebsite;
                    this.saveWebsites(websites);
                    return true;
                }
                return false;
            },

            // 删除网站
            deleteWebsite: function (id) {
                const websites = this.getWebsites();
                const filteredWebsites = websites.filter(w => w.id !== id);
                this.saveWebsites(filteredWebsites);
                return filteredWebsites;
            },

            // 添加新分类
            addCategory: function (category) {
                const categories = this.getCategories();
                if (!categories.includes(category) && category !== "全部") {
                    categories.push(category);
                    this.saveCategories(categories);
                }
                return categories;
            }
        };

        // 页面管理
        const PageManager = {
            currentPage: 'home',
            editMode: false,

            init: function () {
                // 初始化数据
                StorageManager.initDefaultData();

                // 设置导航事件
                this.setupNavigation();

                // 设置功能按钮事件
                this.setupUtilityButtons();

                // 初始化主页
                this.initHomePage();

                // 初始化模态框
                this.initModal();

                // 初始加载完成
                console.log('办公导航助手已初始化');
            },

            setupNavigation: function () {
                // 编辑模式切换
                document.getElementById('toggle-edit').addEventListener('click', () => this.toggleEditMode());

                // 添加网站按钮
                document.getElementById('add-website').addEventListener('click', () => this.openWebsiteModal());

                // 搜索表单提交
                document.getElementById('search-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.performSearch();
                });

                // 搜索输入框回车键支持
                document.getElementById('search-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });
            },

            setupUtilityButtons: function () {
                // 添加到收藏按钮
                const addToFavoritesBtn = document.getElementById('add-to-favorites');
                if (addToFavoritesBtn) {
                    addToFavoritesBtn.addEventListener('click', () => this.addToFavorites());
                }

                // 设为首页按钮
                const setAsHomepageBtn = document.getElementById('set-as-homepage');
                if (setAsHomepageBtn) {
                    setAsHomepageBtn.addEventListener('click', () => this.setAsHomepage());
                }
            },

            showPage: function (page) {
                // 隐藏所有页面
                document.querySelectorAll('.page').forEach(p => p.style.display = 'none');

                // 显示目标页面
                document.getElementById(`${page}-page`).style.display = 'block';

                // 设置导航激活状态
                document.getElementById(`nav-${page}`).classList.add('active');

                // 更新当前页面
                this.currentPage = page;

                // 退出编辑模式
                this.editMode = false;
                document.getElementById('toggle-edit').innerHTML = '<i class="fas fa-edit"></i>编辑模式';
                this.updateEditModeUI();

                // 滚动到顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // 关闭移动端菜单
                const mainNav = document.getElementById('main-nav');
                if (mainNav.classList.contains('active')) {
                    mainNav.classList.remove('active');
                    document.getElementById('mobile-menu-btn').querySelector('i').classList.remove('fa-times');
                    document.getElementById('mobile-menu-btn').querySelector('i').classList.add('fa-bars');
                }
            },

            toggleEditMode: function () {
                this.editMode = !this.editMode;
                const toggleBtn = document.getElementById('toggle-edit');
                toggleBtn.innerHTML = this.editMode ?
                    '<i class="fas fa-times"></i>退出编辑' :
                    '<i class="fas fa-edit"></i>编辑模式';

                toggleBtn.classList.toggle('btn-secondary', !this.editMode);
                toggleBtn.classList.toggle('btn', this.editMode);

                this.updateEditModeUI();
            },

            updateEditModeUI: function () {
                const websitesGrid = document.getElementById('websites-grid');
                if (!websitesGrid) return;

                const websiteCards = websitesGrid.querySelectorAll('.website-card');
                websiteCards.forEach(card => {
                    if (this.editMode) {
                        // 添加删除按钮
                        if (!card.querySelector('.delete-btn')) {
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'delete-btn';
                            deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                            deleteBtn.title = '删除网站';

                            const websiteId = parseInt(card.dataset.id);
                            deleteBtn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                this.deleteWebsite(websiteId);
                            });

                            card.appendChild(deleteBtn);
                        }

                        // 添加编辑指示
                        card.style.cursor = 'default';
                    } else {
                        // 移除删除按钮
                        const deleteBtn = card.querySelector('.delete-btn');
                        if (deleteBtn) {
                            deleteBtn.remove();
                        }

                        // 恢复点击功能
                        card.style.cursor = 'pointer';
                    }
                });
            },

            initHomePage: function () {
                // 初始化搜索引擎选择器
                this.initSearchEngines();

                // 初始化网址导航
                this.initWebsiteNavigation();
            },

            initSearchEngines: function () {
                const engines = StorageManager.getSearchEngines();
                const selectedEngine = StorageManager.getSelectedEngine();
                const engineSelector = document.getElementById('engine-selector');

                engineSelector.innerHTML = '';

                engines.forEach(engine => {
                    const engineOption = document.createElement('div');
                    engineOption.className = `engine-option ${engine.name === selectedEngine.name ? 'selected' : ''}`;
                    engineOption.dataset.name = engine.name;
                    engineOption.title = `使用 ${engine.name} 搜索`;

                    engineOption.innerHTML = `
                        <i class="${engine.icon}"></i>
                        <span>${engine.name}</span>
                    `;

                    engineOption.addEventListener('click', () => {
                        document.querySelectorAll('.engine-option').forEach(opt => opt.classList.remove('selected'));
                        engineOption.classList.add('selected');
                        StorageManager.saveSelectedEngine(engine);

                        // 移动端优化：点击后自动聚焦搜索框
                        if (window.innerWidth < 768) {
                            document.getElementById('search-input').focus();
                        }
                    });

                    engineSelector.appendChild(engineOption);
                });
            },

            initWebsiteNavigation: function () {
                const websites = StorageManager.getWebsites();
                const categories = StorageManager.getCategories();
                const categoryTabs = document.getElementById('category-tabs');
                const websitesGrid = document.getElementById('websites-grid');

                // 如果没有网站，显示空状态
                if (websites.length === 0) {
                    websitesGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-compass"></i>
                            <h3>暂无网站</h3>
                            <p>点击"添加网站"按钮来添加第一个网站</p>
                            <button class="btn" id="add-first-website" style="margin-top: 20px;">
                                <i class="fas fa-plus"></i> 添加网站
                            </button>
                        </div>
                    `;

                    document.getElementById('add-first-website').addEventListener('click', () => {
                        this.openWebsiteModal();
                    });

                    return;
                }

                // 生成分类标签
                categoryTabs.innerHTML = '';
                categories.forEach(category => {
                    const tab = document.createElement('div');
                    tab.className = `category-tab ${category === '全部' ? 'active' : ''}`;
                    tab.textContent = category;
                    tab.dataset.category = category;

                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.filterWebsitesByCategory(category);
                    });

                    categoryTabs.appendChild(tab);
                });

                // 生成网站卡片
                this.renderWebsites(websites);
            },

            renderWebsites: function (websites) {
                const websitesGrid = document.getElementById('websites-grid');
                if (!websitesGrid) return;

                websitesGrid.innerHTML = '';

                websites.forEach(website => {
                    const card = document.createElement('div');
                    card.className = 'website-card';
                    card.dataset.id = website.id;
                    card.dataset.category = website.category;

                    card.innerHTML = `
                        <div class="website-icon">
                            <i class="${website.icon}"></i>
                        </div>
                        <div class="website-info">
                            <h3>${website.name}</h3>
                            <p>${website.description || website.category}</p>
                            <div class="website-category">${website.category}</div>
                        </div>
                    `;

                    // 点击打开网站
                    card.addEventListener('click', () => {
                        if (!this.editMode) {
                            window.open(website.url, '_blank');
                        }
                    });

                    websitesGrid.appendChild(card);
                });

                // 更新编辑模式UI
                this.updateEditModeUI();
            },

            filterWebsitesByCategory: function (category) {
                const websites = StorageManager.getWebsites();
                let filteredWebsites;

                if (category === '全部') {
                    filteredWebsites = websites;
                } else {
                    filteredWebsites = websites.filter(website => website.category === category);
                }

                // 如果没有符合条件的网站，显示空状态
                if (filteredWebsites.length === 0) {
                    const websitesGrid = document.getElementById('websites-grid');
                    websitesGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <h3>此分类暂无网站</h3>
                            <p>尝试切换到其他分类或添加新网站</p>
                        </div>
                    `;
                    return;
                }

                this.renderWebsites(filteredWebsites);
            },

            performSearch: function () {
                const searchInput = document.getElementById('search-input');
                const query = searchInput.value.trim();

                if (!query) {
                    this.showMessage('请输入搜索关键词', 'warning');
                    searchInput.focus();
                    return;
                }

                const selectedEngine = StorageManager.getSelectedEngine();
                const searchUrl = selectedEngine.url + encodeURIComponent(query);

                window.open(searchUrl, '_blank');
                searchInput.value = '';

                // 记录搜索历史
                this.recordSearchHistory(query, selectedEngine.name);
            },

            recordSearchHistory: function (query, engine) {
                let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
                history.unshift({
                    query: query,
                    engine: engine,
                    timestamp: new Date().toISOString()
                });

                // 只保留最近10条记录
                history = history.slice(0, 10);
                localStorage.setItem('searchHistory', JSON.stringify(history));
            },

            // 添加到收藏功能
            addToFavorites: function () {
                const pageTitle = document.title;
                const pageUrl = window.location.href;

                // 尝试添加到收藏夹
                try {
                    // 由于安全限制，大多数现代浏览器不允许脚本直接添加收藏
                    // 所以我们需要提供用户手动操作的指导
                    this.showCustomMessage(
                        `<div style="text-align: left; line-height: 1.6;">
                            <p><strong>将此页面添加到收藏夹：</strong></p>
                            <div style="margin-left: 20px;">
                                <p><strong>方法一：使用快捷键</strong></p>
                                <p>• Windows/Linux: 按 <kbd style="background: #e2e8f0; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Ctrl</kbd> + <kbd style="background: #e2e8f0; padding: 4px 8px; border-radius: 4px; font-weight: bold;">D</kbd></p>
                                <p>• Mac: 按 <kbd style="background: #e2e8f0; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Cmd</kbd> + <kbd style="background: #e2e8f0; padding: 4px 8px; border-radius: 4px; font-weight: bold;">D</kbd></p>
                                
                                <p style="margin-top: 15px;"><strong>方法二：使用浏览器菜单</strong></p>
                                <p>• 点击浏览器地址栏右侧的星标图标 ☆</p>
                                <p>• 或点击浏览器菜单 → 添加到收藏夹</p>
                            </div>
                            <p style="margin-top: 15px; color: var(--accent-color);">
                                页面标题：${pageTitle}<br>
                                页面网址：<code style="word-break: break-all;">${pageUrl}</code>
                            </p>
                        </div>`,
                        '添加到收藏夹'
                    );
                } catch (error) {
                    this.showMessage('操作失败，请手动添加收藏', 'warning');
                }
            },

            // 设为首页功能
            setAsHomepage: function () {
                // 获取当前页面URL
                const pageUrl = window.location.href;

                this.showCustomMessage(
                    `<div style="text-align: left; line-height: 1.6;">
                        <p><strong>将此页面设为首页的步骤：</strong></p>
                        <div style="margin-left: 20px;">
                            <p><strong>Chrome浏览器：</strong></p>
                            <p>1. 点击右上角三个点 → 设置</p>
                            <p>2. 在"启动时"部分，选择"打开特定网页或一组网页"</p>
                            <p>3. 点击"添加新网页"，输入：<code>${pageUrl}</code></p>
                            
                            <p style="margin-top: 10px;"><strong>Firefox浏览器：</strong></p>
                            <p>1. 点击右上角三条线 → 选项</p>
                            <p>2. 选择"主页"部分</p>
                            <p>3. 在"主页和新窗口"中输入：<code>${pageUrl}</code></p>
                            
                            <p style="margin-top: 10px;"><strong>Edge浏览器：</strong></p>
                            <p>1. 点击右上角三个点 → 设置</p>
                            <p>2. 选择"开始、主页和新建标签页"</p>
                            <p>3. 在"主页"部分，打开"输入网址"开关</p>
                            <p>4. 输入：<code>${pageUrl}</code></p>
                            
                            <p style="margin-top: 10px;"><strong>Safari浏览器：</strong></p>
                            <p>1. 点击 Safari → 偏好设置</p>
                            <p>2. 选择"通用"标签</p>
                            <p>3. 在"主页"字段中输入：<code>${pageUrl}</code></p>
                        </div>
                        <p style="margin-top: 15px; color: var(--accent-color);">
                            当前页面网址：<br><code style="word-break: break-all;">${pageUrl}</code>
                        </p>
                    </div>`,
                    '设为首页指导'
                );
            },

            // 显示自定义消息（用于显示更复杂的HTML内容）
            showCustomMessage: function (content, title = '提示') {
                // 创建模态框
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.style.display = 'flex';

                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${title}</h2>
                            <button class="close-modal">&times;</button>
                        </div>
                        <div style="padding: 20px 0;">
                            ${content}
                        </div>
                        <div class="form-actions">
                            <button class="btn" id="copy-url-btn">
                                <i class="fas fa-copy"></i> 复制网址
                            </button>
                            <button class="btn btn-secondary" id="close-custom-modal">
                                关闭
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // 关闭按钮事件
                const closeBtn = modal.querySelector('.close-modal');
                const closeCustomBtn = modal.querySelector('#close-custom-modal');

                const closeModal = () => {
                    modal.style.opacity = '0';
                    setTimeout(() => {
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                    }, 300);
                };

                closeBtn.addEventListener('click', closeModal);
                closeCustomBtn.addEventListener('click', closeModal);

                // 点击模态框外部关闭
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                // 复制网址按钮
                const copyUrlBtn = modal.querySelector('#copy-url-btn');
                copyUrlBtn.addEventListener('click', () => {
                    const pageUrl = window.location.href;
                    navigator.clipboard.writeText(pageUrl).then(() => {
                        this.showMessage('网址已复制到剪贴板！', 'success');
                        closeModal();
                    }).catch(() => {
                        // 如果clipboard API失败，使用传统方法
                        const textArea = document.createElement('textarea');
                        textArea.value = pageUrl;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        this.showMessage('网址已复制到剪贴板！', 'success');
                        closeModal();
                    });
                });
            },

            initModal: function () {
                const modal = document.getElementById('website-modal');
                const closeModal = document.getElementById('close-modal');
                const cancelModal = document.getElementById('cancel-modal');
                const websiteForm = document.getElementById('website-form');

                // 关闭模态框
                closeModal.addEventListener('click', () => this.closeWebsiteModal());
                cancelModal.addEventListener('click', () => this.closeWebsiteModal());

                // 点击模态框外部关闭
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.closeWebsiteModal();
                    }
                });

                // 表单提交
                websiteForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveWebsite();
                });

                // 初始化分类选择
                this.updateCategorySelect();
            },

            openWebsiteModal: function (website = null) {
                const modal = document.getElementById('website-modal');
                const modalTitle = document.getElementById('modal-title');
                const form = document.getElementById('website-form');

                if (website) {
                    // 编辑模式
                    modalTitle.textContent = '编辑网站';
                    form.dataset.mode = 'edit';
                    form.dataset.id = website.id;

                    document.getElementById('website-name').value = website.name;
                    document.getElementById('website-url').value = website.url;
                    document.getElementById('website-category').value = website.category;
                    document.getElementById('website-icon').value = website.icon;
                    document.getElementById('website-description').value = website.description || '';
                } else {
                    // 添加模式
                    modalTitle.textContent = '添加新网站';
                    form.dataset.mode = 'add';
                    form.reset();

                    // 设置默认图标
                    document.getElementById('website-icon').value = 'fas fa-globe';
                }

                modal.classList.add('active');
                document.getElementById('website-name').focus();
            },

            closeWebsiteModal: function () {
                const modal = document.getElementById('website-modal');
                modal.classList.remove('active');
                document.getElementById('website-form').reset();
            },

            updateCategorySelect: function () {
                const categories = StorageManager.getCategories();
                const categorySelect = document.getElementById('website-category');

                // 移除"全部"选项
                const filteredCategories = categories.filter(cat => cat !== '全部');

                categorySelect.innerHTML = '';
                filteredCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });

                // 添加"新分类"选项
                const newOption = document.createElement('option');
                newOption.value = '__new__';
                newOption.textContent = '+ 添加新分类';
                categorySelect.appendChild(newOption);
            },

            saveWebsite: function () {
                const form = document.getElementById('website-form');
                const mode = form.dataset.mode;

                const websiteData = {
                    name: document.getElementById('website-name').value.trim(),
                    url: document.getElementById('website-url').value.trim(),
                    category: document.getElementById('website-category').value,
                    icon: document.getElementById('website-icon').value.trim(),
                    description: document.getElementById('website-description').value.trim()
                };

                // 验证数据
                if (!websiteData.name || !websiteData.url || !websiteData.category || !websiteData.icon) {
                    this.showMessage('请填写所有必填字段', 'warning');
                    return;
                }

                // 检查URL格式
                if (!this.isValidUrl(websiteData.url)) {
                    this.showMessage('请输入有效的URL地址', 'warning');
                    return;
                }

                // 检查是否要添加新分类
                if (websiteData.category === '__new__') {
                    const newCategory = prompt('请输入新分类名称:');
                    if (!newCategory) {
                        this.showMessage('分类名称不能为空', 'warning');
                        return;
                    }

                    if (newCategory === '全部') {
                        this.showMessage('不能使用"全部"作为分类名称', 'warning');
                        return;
                    }

                    // 添加新分类
                    StorageManager.addCategory(newCategory);
                    websiteData.category = newCategory;

                    // 更新分类选择
                    this.updateCategorySelect();

                    // 更新分类标签
                    this.initWebsiteNavigation();
                }

                if (mode === 'edit') {
                    websiteData.id = parseInt(form.dataset.id);
                    StorageManager.updateWebsite(websiteData);
                    this.showMessage('网站更新成功!', 'success');
                } else {
                    StorageManager.addWebsite(websiteData);
                    this.showMessage('网站添加成功!', 'success');
                }

                // 重新渲染网站列表
                const activeCategory = document.querySelector('.category-tab.active')?.dataset.category || '全部';
                this.filterWebsitesByCategory(activeCategory);

                // 关闭模态框
                this.closeWebsiteModal();
            },

            deleteWebsite: function (id) {
                if (!confirm('确定要删除这个网站吗？此操作不可撤销。')) {
                    return;
                }

                StorageManager.deleteWebsite(id);

                // 重新渲染网站列表
                const activeCategory = document.querySelector('.category-tab.active')?.dataset.category || '全部';
                this.filterWebsitesByCategory(activeCategory);

                this.showMessage('网站已删除!', 'success');
            },

            showMessage: function (message, type = 'info') {
                // 创建消息元素
                const messageEl = document.createElement('div');
                messageEl.className = `message message-${type}`;
                messageEl.innerHTML = `
                    <span>${message}</span>
                    <button class="message-close">&times;</button>
                `;

                // 样式
                messageEl.style.position = 'fixed';
                messageEl.style.top = '20px';
                messageEl.style.right = '20px';
                messageEl.style.left = '20px';
                messageEl.style.maxWidth = '400px';
                messageEl.style.margin = '0 auto';
                messageEl.style.padding = '15px 20px';
                messageEl.style.borderRadius = 'var(--border-radius)';
                messageEl.style.boxShadow = 'var(--shadow-lg)';
                messageEl.style.zIndex = '1000';
                messageEl.style.display = 'flex';
                messageEl.style.justifyContent = 'space-between';
                messageEl.style.alignItems = 'center';
                messageEl.style.fontWeight = '600';
                messageEl.style.animation = 'modalFadeIn 0.3s ease';

                // 根据类型设置颜色
                const colors = {
                    success: { bg: '#c6f6d5', text: '#22543d', border: '#9ae6b4' },
                    warning: { bg: '#feebc8', text: '#744210', border: '#fbd38d' },
                    info: { bg: '#bee3f8', text: '#2c5282', border: '#90cdf4' }
                };

                const color = colors[type] || colors.info;
                messageEl.style.backgroundColor = color.bg;
                messageEl.style.color = color.text;
                messageEl.style.border = `1px solid ${color.border}`;

                // 关闭按钮
                const closeBtn = messageEl.querySelector('.message-close');
                closeBtn.style.background = 'none';
                closeBtn.style.border = 'none';
                closeBtn.style.fontSize = '1.5rem';
                closeBtn.style.cursor = 'pointer';
                closeBtn.style.color = 'inherit';
                closeBtn.style.padding = '0';
                closeBtn.style.width = '24px';
                closeBtn.style.height = '24px';
                closeBtn.style.display = 'flex';
                closeBtn.style.alignItems = 'center';
                closeBtn.style.justifyContent = 'center';

                closeBtn.addEventListener('click', () => {
                    messageEl.style.opacity = '0';
                    messageEl.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            messageEl.parentNode.removeChild(messageEl);
                        }
                    }, 300);
                });

                // 添加到页面
                document.body.appendChild(messageEl);

                // 3秒后自动消失
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        closeBtn.click();
                    }
                }, 3000);
            },

            isValidUrl: function (string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            PageManager.init();

            // 添加键盘快捷键支持
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K 聚焦搜索框
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const searchInput = document.getElementById('search-input');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }

                // Esc 键关闭模态框
                if (e.key === 'Escape') {
                    const modal = document.getElementById('website-modal');
                    if (modal.classList.contains('active')) {
                        PageManager.closeWebsiteModal();
                    }

                    // 关闭自定义消息模态框
                    const customModal = document.querySelector('.modal:not(#website-modal)');
                    if (customModal && customModal.classList.contains('active')) {
                        customModal.querySelector('.close-modal')?.click();
                    }
                }

                // Ctrl/Cmd + D 添加到收藏
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    PageManager.addToFavorites();
                }
            });

            // 添加页面加载动画
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.3s ease';

            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 50);

            // 添加快捷键提示
            setTimeout(() => {
                PageManager.showMessage(
                    '提示：按 Ctrl+K 快速聚焦搜索框，按 Ctrl+D 添加到收藏夹',
                    'info'
                );
            }, 2000);
        });
    </script>
</body>

</html>